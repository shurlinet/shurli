<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 440" width="800" height="440">
  <defs>
    <linearGradient id="peerFill" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#2c2a2e;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#1e1d20;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="relayFill" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#38353b;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#2a282c;stop-opacity:1" />
    </linearGradient>
    <filter id="glow">
      <feGaussianBlur stdDeviation="2" result="coloredBlur"/>
      <feMerge>
        <feMergeNode in="coloredBlur"/>
        <feMergeNode in="SourceGraphic"/>
      </feMerge>
    </filter>
  </defs>

  <!-- Background -->
  <rect width="800" height="440" rx="12" fill="#141316"/>

  <!-- Title -->
  <text x="400" y="28" font-family="system-ui, sans-serif" font-size="14" fill="#c0caf5" text-anchor="middle" font-weight="600">PAKE-Encrypted Invite Handshake</text>

  <!-- Inviter header -->
  <rect x="60" y="45" width="120" height="36" rx="8" fill="url(#peerFill)" stroke="#da1c5c" stroke-width="1.3"/>
  <text x="120" y="67" font-family="system-ui, sans-serif" font-size="12" fill="#c0caf5" text-anchor="middle" font-weight="600">Inviter</text>

  <!-- Relay header -->
  <rect x="340" y="45" width="120" height="36" rx="8" fill="url(#relayFill)" stroke="#bb9af7" stroke-width="1.3"/>
  <text x="400" y="67" font-family="system-ui, sans-serif" font-size="12" fill="#c0caf5" text-anchor="middle" font-weight="600">Relay</text>

  <!-- Joiner header -->
  <rect x="620" y="45" width="120" height="36" rx="8" fill="url(#peerFill)" stroke="#da1c5c" stroke-width="1.3"/>
  <text x="680" y="67" font-family="system-ui, sans-serif" font-size="12" fill="#c0caf5" text-anchor="middle" font-weight="600">Joiner</text>

  <!-- Vertical lifelines -->
  <line x1="120" y1="81" x2="120" y2="415" stroke="#565f89" stroke-width="1" stroke-dasharray="4,3" opacity="0.4"/>
  <line x1="400" y1="81" x2="400" y2="415" stroke="#565f89" stroke-width="1" stroke-dasharray="4,3" opacity="0.4"/>
  <line x1="680" y1="81" x2="680" y2="415" stroke="#565f89" stroke-width="1" stroke-dasharray="4,3" opacity="0.4"/>

  <!-- Pre-step: Both generate ephemeral keys -->
  <rect x="55" y="94" width="130" height="20" rx="4" fill="#1e1d20" stroke="#565f89" stroke-width="0.8"/>
  <text x="120" y="108" font-family="SF Mono, monospace" font-size="9" fill="#9ece6a" text-anchor="middle">X25519 keygen</text>
  <rect x="615" y="94" width="130" height="20" rx="4" fill="#1e1d20" stroke="#565f89" stroke-width="0.8"/>
  <text x="680" y="108" font-family="SF Mono, monospace" font-size="9" fill="#9ece6a" text-anchor="middle">X25519 keygen</text>

  <!-- Step 1: Exchange public keys -->
  <line x1="120" y1="135" x2="680" y2="135" stroke="#e8729a" stroke-width="2" filter="url(#glow)"/>
  <polygon points="674,130 674,140 683,135" fill="#e8729a"/>
  <text x="400" y="128" font-family="SF Mono, monospace" font-size="10" fill="#e8729a" text-anchor="middle" font-weight="600">1. Ephemeral public key</text>

  <line x1="680" y1="160" x2="120" y2="160" stroke="#e8729a" stroke-width="2" filter="url(#glow)"/>
  <polygon points="126,155 126,165 117,160" fill="#e8729a"/>
  <text x="400" y="153" font-family="SF Mono, monospace" font-size="10" fill="#e8729a" text-anchor="middle" font-weight="600">1. Ephemeral public key</text>

  <!-- Relay sees annotation (right side, outside arrows) -->
  <text x="760" y="148" font-family="SF Mono, monospace" font-size="8" fill="#565f89" text-anchor="end" opacity="0.7">relay sees:</text>
  <text x="760" y="159" font-family="SF Mono, monospace" font-size="8" fill="#565f89" text-anchor="end" opacity="0.7">pub keys only</text>

  <!-- Step 2: Both derive AEAD key -->
  <rect x="30" y="180" width="180" height="32" rx="4" fill="#1e1d20" stroke="#9ece6a" stroke-width="0.8"/>
  <text x="120" y="193" font-family="SF Mono, monospace" font-size="9" fill="#9ece6a" text-anchor="middle">2. HKDF-SHA256(</text>
  <text x="120" y="206" font-family="SF Mono, monospace" font-size="9" fill="#9ece6a" text-anchor="middle">DH-secret || invite-code)</text>

  <rect x="590" y="180" width="180" height="32" rx="4" fill="#1e1d20" stroke="#9ece6a" stroke-width="0.8"/>
  <text x="680" y="193" font-family="SF Mono, monospace" font-size="9" fill="#9ece6a" text-anchor="middle">2. HKDF-SHA256(</text>
  <text x="680" y="206" font-family="SF Mono, monospace" font-size="9" fill="#9ece6a" text-anchor="middle">DH-secret || invite-code)</text>

  <!-- Invite code callout -->
  <text x="400" y="200" font-family="SF Mono, monospace" font-size="9" fill="#e0af68" text-anchor="middle">invite code never</text>
  <text x="400" y="212" font-family="SF Mono, monospace" font-size="9" fill="#e0af68" text-anchor="middle">crosses the wire</text>

  <!-- Step 3: Encrypted peer name + peer ID -->
  <line x1="120" y1="235" x2="680" y2="235" stroke="#bb9af7" stroke-width="2" filter="url(#glow)"/>
  <polygon points="674,230 674,240 683,235" fill="#bb9af7"/>
  <text x="400" y="228" font-family="SF Mono, monospace" font-size="10" fill="#bb9af7" text-anchor="middle" font-weight="600">3. XChaCha20-Poly1305(name, peer ID)</text>

  <line x1="680" y1="260" x2="120" y2="260" stroke="#bb9af7" stroke-width="2" filter="url(#glow)"/>
  <polygon points="126,255 126,265 117,260" fill="#bb9af7"/>
  <text x="400" y="253" font-family="SF Mono, monospace" font-size="10" fill="#bb9af7" text-anchor="middle" font-weight="600">3. XChaCha20-Poly1305(name, peer ID)</text>

  <!-- Relay sees annotation (right side, outside arrows) -->
  <text x="760" y="248" font-family="SF Mono, monospace" font-size="8" fill="#565f89" text-anchor="end" opacity="0.7">relay sees:</text>
  <text x="760" y="259" font-family="SF Mono, monospace" font-size="8" fill="#565f89" text-anchor="end" opacity="0.7">ciphertext only</text>

  <!-- Step 4: Key confirmation MACs -->
  <line x1="120" y1="295" x2="680" y2="295" stroke="#e0af68" stroke-width="2" filter="url(#glow)"/>
  <polygon points="674,290 674,300 683,295" fill="#e0af68"/>
  <text x="400" y="288" font-family="SF Mono, monospace" font-size="10" fill="#e0af68" text-anchor="middle" font-weight="600">4. HMAC confirmation (role: inviter)</text>

  <line x1="680" y1="320" x2="120" y2="320" stroke="#e0af68" stroke-width="2" filter="url(#glow)"/>
  <polygon points="126,315 126,325 117,320" fill="#e0af68"/>
  <text x="400" y="313" font-family="SF Mono, monospace" font-size="10" fill="#e0af68" text-anchor="middle" font-weight="600">4. HMAC confirmation (role: joiner)</text>

  <!-- Step 5: Mutual authorization -->
  <rect x="35" y="345" width="170" height="30" rx="6" fill="#1e1d20" stroke="#9ece6a" stroke-width="1"/>
  <text x="120" y="364" font-family="SF Mono, monospace" font-size="10" fill="#9ece6a" text-anchor="middle" font-weight="600">5. authorized_keys += B</text>

  <rect x="595" y="345" width="170" height="30" rx="6" fill="#1e1d20" stroke="#9ece6a" stroke-width="1"/>
  <text x="680" y="364" font-family="SF Mono, monospace" font-size="10" fill="#9ece6a" text-anchor="middle" font-weight="600">5. authorized_keys += A</text>

  <!-- Result box -->
  <rect x="250" y="390" width="300" height="28" rx="6" fill="#1e1d20" stroke="#9ece6a" stroke-width="1" opacity="0.7"/>
  <text x="400" y="408" font-family="system-ui, sans-serif" font-size="11" fill="#9ece6a" text-anchor="middle" font-weight="600">Mutually authorized - wrong code = silent failure</text>

  <!-- Bottom note -->
  <text x="400" y="435" font-family="system-ui, sans-serif" font-size="10" fill="#565f89" text-anchor="middle" opacity="0.7">
    v1 cleartext protocol deleted - zero downgrade surface
  </text>
</svg>
