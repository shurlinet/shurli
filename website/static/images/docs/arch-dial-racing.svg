<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 780 570" width="780" height="570">
  <defs>
    <linearGradient id="nodeFill" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#2d3561;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#1e2140;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="successFill" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#1e3a2f;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#162c24;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="relayFill" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#3b3078;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#251e50;stop-opacity:1" />
    </linearGradient>
    <filter id="glow">
      <feGaussianBlur stdDeviation="3" result="coloredBlur"/>
      <feMerge>
        <feMergeNode in="coloredBlur"/>
        <feMergeNode in="SourceGraphic"/>
      </feMerge>
    </filter>
  </defs>

  <!-- Background -->
  <rect width="780" height="560" rx="12" fill="#0f1117"/>

  <!-- Title -->
  <text x="390" y="30" font-family="system-ui, sans-serif" font-size="15" fill="#c0caf5" text-anchor="middle" font-weight="700">Parallel Dial Racing Flow</text>
  <text x="390" y="48" font-family="SF Mono, monospace" font-size="10" fill="#565f89" text-anchor="middle">PathDialer.DialPeer() - 45s worst case becomes fastest-path-wins</text>

  <!-- Step 1: Entry -->
  <rect x="280" y="65" width="220" height="40" rx="10" fill="url(#nodeFill)" stroke="#e8729a" stroke-width="1.5"/>
  <text x="390" y="83" font-family="SF Mono, monospace" font-size="11" fill="#e8729a" text-anchor="middle" font-weight="600">DialPeer(ctx, peerID)</text>
  <text x="390" y="98" font-family="SF Mono, monospace" font-size="8" fill="#565f89" text-anchor="middle">called by proxy, ping, traceroute</text>

  <!-- Arrow to decision -->
  <line x1="390" y1="105" x2="390" y2="128" stroke="#e8729a" stroke-width="1.2"/>
  <polygon points="385,125 395,125 390,133" fill="#e8729a"/>

  <!-- Decision: Already connected? -->
  <polygon points="390,135 520,175 390,215 260,175" fill="url(#nodeFill)" stroke="#e0af68" stroke-width="1.5"/>
  <text x="390" y="171" font-family="system-ui, sans-serif" font-size="11" fill="#c0caf5" text-anchor="middle" font-weight="600">Already</text>
  <text x="390" y="185" font-family="system-ui, sans-serif" font-size="11" fill="#c0caf5" text-anchor="middle" font-weight="600">connected?</text>

  <!-- YES arrow (left) - fast path -->
  <line x1="260" y1="175" x2="165" y2="175" stroke="#9ece6a" stroke-width="2" filter="url(#glow)"/>
  <polygon points="170,170 170,180 160,175" fill="#9ece6a"/>
  <text x="212" y="173" font-family="system-ui, sans-serif" font-size="10" fill="#9ece6a" text-anchor="middle" font-weight="600">YES</text>

  <!-- Fast path result -->
  <rect x="30" y="155" width="130" height="44" rx="10" fill="url(#successFill)" stroke="#9ece6a" stroke-width="1.5"/>
  <text x="95" y="174" font-family="system-ui, sans-serif" font-size="11" fill="#9ece6a" text-anchor="middle" font-weight="600">Instant return</text>
  <text x="95" y="190" font-family="SF Mono, monospace" font-size="8" fill="#9ece6a" text-anchor="middle" opacity="0.8">classify existing path</text>

  <!-- NO arrow (down) -->
  <line x1="390" y1="215" x2="390" y2="248" stroke="#f7768e" stroke-width="1.5"/>
  <polygon points="385,245 395,245 390,253" fill="#f7768e"/>
  <text x="405" y="237" font-family="system-ui, sans-serif" font-size="10" fill="#f7768e" font-weight="600">NO</text>

  <!-- Parallel race box -->
  <rect x="110" y="255" width="560" height="120" rx="12" fill="#0f1117" stroke="#bb9af7" stroke-width="1.8" stroke-dasharray="6,3"/>
  <text x="390" y="275" font-family="system-ui, sans-serif" font-size="12" fill="#bb9af7" text-anchor="middle" font-weight="600">Parallel Race (first success wins)</text>

  <!-- DHT Strategy -->
  <rect x="130" y="288" width="240" height="72" rx="8" fill="url(#relayFill)" stroke="#bb9af7" stroke-width="1.2"/>
  <text x="250" y="308" font-family="system-ui, sans-serif" font-size="11" fill="#c0caf5" text-anchor="middle" font-weight="600">Strategy A: DHT Discovery</text>
  <text x="250" y="326" font-family="SF Mono, monospace" font-size="9" fill="#a9b1d6" text-anchor="middle">kdht.FindPeer(ctx, peerID)</text>
  <text x="250" y="342" font-family="SF Mono, monospace" font-size="9" fill="#565f89" text-anchor="middle">timeout: 15s</text>
  <text x="250" y="355" font-family="SF Mono, monospace" font-size="8" fill="#9ece6a" text-anchor="middle">result: DIRECT connection</text>

  <!-- Relay Strategy -->
  <rect x="400" y="288" width="250" height="72" rx="8" fill="url(#relayFill)" stroke="#bb9af7" stroke-width="1.2"/>
  <text x="525" y="308" font-family="system-ui, sans-serif" font-size="11" fill="#c0caf5" text-anchor="middle" font-weight="600">Strategy B: Relay Circuit</text>
  <text x="525" y="326" font-family="SF Mono, monospace" font-size="9" fill="#a9b1d6" text-anchor="middle">host.Connect(ctx, relayAddr)</text>
  <text x="525" y="342" font-family="SF Mono, monospace" font-size="9" fill="#565f89" text-anchor="middle">timeout: 30s</text>
  <text x="525" y="355" font-family="SF Mono, monospace" font-size="8" fill="#e0af68" text-anchor="middle">result: RELAYED connection</text>

  <!-- VS / parallel symbol -->
  <circle cx="385" cy="324" r="14" fill="#0f1117" stroke="#e0af68" stroke-width="1.2"/>
  <text x="385" y="329" font-family="SF Mono, monospace" font-size="10" fill="#e0af68" text-anchor="middle" font-weight="700">||</text>

  <!-- Arrow from race to winner -->
  <line x1="390" y1="375" x2="390" y2="405" stroke="#e8729a" stroke-width="1.2"/>
  <polygon points="385,402 395,402 390,410" fill="#e8729a"/>
  <text x="390" y="398" font-family="SF Mono, monospace" font-size="8" fill="#565f89" text-anchor="middle">winner arrives, cancel loser</text>

  <!-- Classify result -->
  <rect x="250" y="412" width="280" height="50" rx="10" fill="url(#nodeFill)" stroke="#da1c5c" stroke-width="1.5"/>
  <text x="390" y="432" font-family="system-ui, sans-serif" font-size="11" fill="#c0caf5" text-anchor="middle" font-weight="600">Classify Winning Path</text>
  <text x="390" y="452" font-family="SF Mono, monospace" font-size="9" fill="#a9b1d6" text-anchor="middle">multiaddr contains /p2p-circuit? â†’ RELAYED : DIRECT</text>

  <!-- Two result paths -->
  <!-- DIRECT result (left) -->
  <line x1="310" y1="462" x2="180" y2="495" stroke="#9ece6a" stroke-width="1.5"/>
  <polygon points="183,491 177,499 185,498" fill="#9ece6a"/>

  <rect x="70" y="490" width="220" height="50" rx="10" fill="url(#successFill)" stroke="#9ece6a" stroke-width="1.5"/>
  <text x="180" y="510" font-family="SF Mono, monospace" font-size="12" fill="#9ece6a" text-anchor="middle" font-weight="700">DIRECT</text>
  <text x="180" y="528" font-family="SF Mono, monospace" font-size="9" fill="#9ece6a" text-anchor="middle" opacity="0.8">IPv6 or hole-punched IPv4</text>

  <!-- RELAYED result (right) -->
  <line x1="470" y1="462" x2="580" y2="495" stroke="#e0af68" stroke-width="1.5"/>
  <polygon points="577,491 583,499 575,498" fill="#e0af68"/>

  <rect x="480" y="490" width="220" height="50" rx="10" fill="url(#nodeFill)" stroke="#e0af68" stroke-width="1.5"/>
  <text x="590" y="510" font-family="SF Mono, monospace" font-size="12" fill="#e0af68" text-anchor="middle" font-weight="700">RELAYED</text>
  <text x="590" y="528" font-family="SF Mono, monospace" font-size="9" fill="#e0af68" text-anchor="middle" opacity="0.8">peer relay or VPS relay</text>

  <!-- Timing comparison -->
  <text x="40" y="546" font-family="SF Mono, monospace" font-size="9" fill="#565f89">
    <tspan fill="#9ece6a">Before:</tspan> sequential DHT (15s) + relay (30s) = 45s worst case
  </text>
  <text x="40" y="558" font-family="SF Mono, monospace" font-size="9" fill="#565f89">
    <tspan fill="#9ece6a">After: </tspan> parallel race = max(fastest strategy) - typically &lt;5s
  </text>
</svg>
