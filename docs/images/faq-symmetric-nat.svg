<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 750 350" width="750" height="350">
  <defs>
    <linearGradient id="deviceFill" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#2d3561;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#1e2140;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="natFill" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#3a1e2f;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#2c1624;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="targetFill" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#3b3078;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#251e50;stop-opacity:1" />
    </linearGradient>
    <filter id="glow">
      <feGaussianBlur stdDeviation="2" result="coloredBlur"/>
      <feMerge>
        <feMergeNode in="coloredBlur"/>
        <feMergeNode in="SourceGraphic"/>
      </feMerge>
    </filter>
  </defs>

  <!-- Background -->
  <rect width="750" height="350" rx="12" fill="#0f1117"/>

  <!-- Title -->
  <text x="375" y="28" font-family="system-ui, sans-serif" font-size="14" fill="#c0caf5" text-anchor="middle" font-weight="600">Why Symmetric NAT Breaks Hole-Punching</text>

  <!-- Your Machine (left) -->
  <rect x="30" y="95" width="130" height="80" rx="10" fill="url(#deviceFill)" stroke="#3b82f6" stroke-width="1.3"/>
  <text x="95" y="125" font-family="system-ui, sans-serif" font-size="12" fill="#c0caf5" text-anchor="middle" font-weight="600">Your Machine</text>
  <text x="95" y="145" font-family="SF Mono, monospace" font-size="9" fill="#565f89" text-anchor="middle">private IP</text>
  <text x="95" y="161" font-family="SF Mono, monospace" font-size="9" fill="#565f89" text-anchor="middle">behind CGNAT</text>

  <!-- CGNAT Box (center) -->
  <rect x="220" y="60" width="120" height="195" rx="10" fill="url(#natFill)" stroke="#f7768e" stroke-width="1.5"/>
  <text x="280" y="83" font-family="system-ui, sans-serif" font-size="11" fill="#f7768e" text-anchor="middle" font-weight="600">Symmetric</text>
  <text x="280" y="97" font-family="system-ui, sans-serif" font-size="11" fill="#f7768e" text-anchor="middle" font-weight="600">NAT</text>

  <!-- Port mapping 1: to Lighthouse -->
  <rect x="232" y="115" width="96" height="28" rx="5" fill="#1a1e36" stroke="#565f89" stroke-width="0.8"/>
  <text x="280" y="133" font-family="SF Mono, monospace" font-size="9" fill="#e0af68" text-anchor="middle">port → 5000</text>

  <!-- Port mapping 2: to Peer B -->
  <rect x="232" y="155" width="96" height="28" rx="5" fill="#1a1e36" stroke="#565f89" stroke-width="0.8"/>
  <text x="280" y="173" font-family="SF Mono, monospace" font-size="9" fill="#e0af68" text-anchor="middle">port → 7832</text>

  <!-- Different! label -->
  <text x="280" y="206" font-family="system-ui, sans-serif" font-size="10" fill="#f7768e" text-anchor="middle" font-weight="600">Different port per</text>
  <text x="280" y="220" font-family="system-ui, sans-serif" font-size="10" fill="#f7768e" text-anchor="middle" font-weight="600">destination!</text>

  <!-- Lighthouse (top right) -->
  <rect x="430" y="70" width="130" height="60" rx="10" fill="url(#targetFill)" stroke="#bb9af7" stroke-width="1.3"/>
  <text x="495" y="96" font-family="system-ui, sans-serif" font-size="11" fill="#c0caf5" text-anchor="middle" font-weight="600">Lighthouse</text>
  <text x="495" y="118" font-family="SF Mono, monospace" font-size="9" fill="#565f89" text-anchor="middle">(STUN / discovery)</text>

  <!-- Peer B (bottom right) -->
  <rect x="430" y="160" width="130" height="60" rx="10" fill="url(#deviceFill)" stroke="#3b82f6" stroke-width="1.3"/>
  <text x="495" y="186" font-family="system-ui, sans-serif" font-size="11" fill="#c0caf5" text-anchor="middle" font-weight="600">Peer B</text>
  <text x="495" y="210" font-family="SF Mono, monospace" font-size="9" fill="#565f89" text-anchor="middle">(target peer)</text>

  <!-- Connection line 1: Machine → NAT → Lighthouse (via port 5000) -->
  <line x1="160" y1="129" x2="232" y2="129" stroke="#7aa2f7" stroke-width="1.5"/>
  <line x1="328" y1="129" x2="430" y2="100" stroke="#9ece6a" stroke-width="1.5" filter="url(#glow)"/>
  <polygon points="426,96 426,106 434,100" fill="#9ece6a"/>
  <text x="390" y="104" font-family="SF Mono, monospace" font-size="8" fill="#9ece6a">:5000</text>

  <!-- Connection line 2: Machine → NAT → Peer B (via port 7832) -->
  <line x1="160" y1="169" x2="232" y2="169" stroke="#7aa2f7" stroke-width="1.5"/>
  <line x1="328" y1="169" x2="430" y2="190" stroke="#f7768e" stroke-width="1.5" stroke-dasharray="6,4"/>
  <polygon points="426,186 426,196 434,190" fill="#f7768e"/>
  <text x="390" y="192" font-family="SF Mono, monospace" font-size="8" fill="#f7768e">:7832</text>

  <!-- Lighthouse tells Peer B the wrong port -->
  <line x1="495" y1="130" x2="495" y2="160" stroke="#e0af68" stroke-width="1.5" stroke-dasharray="4,3"/>
  <polygon points="490,156 500,156 495,164" fill="#e0af68"/>
  <text x="595" y="148" font-family="SF Mono, monospace" font-size="9" fill="#e0af68">"Connect to :5000"</text>

  <!-- Big red X on the failed punch -->
  <line x1="590" y1="170" x2="625" y2="205" stroke="#f7768e" stroke-width="3" opacity="0.8"/>
  <line x1="625" y1="170" x2="590" y2="205" stroke="#f7768e" stroke-width="3" opacity="0.8"/>

  <!-- Failure explanation -->
  <rect x="580" y="168" width="145" height="44" rx="6" fill="url(#natFill)" stroke="#f7768e" stroke-width="1" opacity="0.8"/>
  <text x="652" y="186" font-family="SF Mono, monospace" font-size="9" fill="#f7768e" text-anchor="middle">Peer B tries :5000</text>
  <text x="652" y="200" font-family="SF Mono, monospace" font-size="9" fill="#f7768e" text-anchor="middle">but NAT mapped :7832</text>

  <!-- Bottom explanation -->
  <rect x="60" y="268" width="630" height="65" rx="8" fill="#1a1e36" stroke="#565f89" stroke-width="0.8" opacity="0.6"/>
  <text x="375" y="290" font-family="system-ui, sans-serif" font-size="11" fill="#c0caf5" text-anchor="middle" font-weight="600">The port the lighthouse reports was allocated for its own connection, not Peer B's</text>
  <text x="375" y="308" font-family="system-ui, sans-serif" font-size="10" fill="#a9b1d6" text-anchor="middle">Symmetric NAT = different mapped port per destination → hole-punch always fails</text>
  <text x="375" y="323" font-family="SF Mono, monospace" font-size="10" fill="#f7768e" text-anchor="middle">Without relay fallback, the connection simply doesn't work</text>
</svg>
